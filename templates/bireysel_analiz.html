{% extends "base.html" %}

{% block content %}
<!-- Error Modal -->
<div id="errorModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3>HatalÄ± GiriÅŸ</h3>
        <p id="errorMessage"></p>
        <button onclick="closeErrorModal()" class="modal-btn">Tamam</button>
    </div>
</div>

<div class="container">
    <h2>NUMEROLOJÄ°-EBCED HESAPLAMA</h2>
    
    <div class="tabs">
        <a href="{{ url_for('bireysel_analiz') }}" class="tab active">Bireysel Analiz</a>
        <a href="{{ url_for('iliski_analizi') }}" class="tab">Ä°liÅŸki Analizi</a>
        <a href="{{ url_for('sure_hesaplama') }}" class="tab">Sure Hesaplama</a>
    </div>

    <div class="form-container">
        <h3>Bilgiler</h3>
        <p class="info">DoÄŸum tarihinizi seÃ§ebilir veya elle girebilirsiniz. (Ã–rn: 09.02.2003 veya 09/02/2003 veya 09 02 2003)</p>
        
        <form method="POST" action="{{ url_for('bireysel_analiz') }}">
            <div class="form-group">
                <label for="dogum_gunu">DoÄŸum Tarihi</label>
                <input type="text" id="dogum_gunu" name="dogum_gunu" placeholder="GG.AA.YYYY veya GG/AA/YYYY" required>
                <input type="date" id="date_picker" onchange="updateDateInput(this.value)">
            </div>
            
            <div class="form-group">
                <label for="isim_soyisim">Ä°sim Soyisim</label>
                <input type="text" id="isim_soyisim" name="isim_soyisim" placeholder="Ä°sim soyisim" required>
            </div>
            
            <div class="form-group">
                <label for="eklenen_isim">Ek Ä°sim (evlilik ismi veya kiÅŸiye eklenecek isim)</label>
                <input type="text" id="eklenen_isim" name="eklenen_isim" placeholder="Eklenen isim (isteÄŸe baÄŸlÄ±)">
            </div>
            
            <button type="submit" class="submit-btn">GÃ¶nder</button>
        </form>
    </div>

    {% if results %}
    <div class="pdf-download-container">
        <button onclick="generatePDF()" class="pdf-download-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            PDF Ä°ndir
        </button>
    </div>
    
    <div class="results">
        <h3>Girdiler:</h3>
        <div class="result-section">
            <p><strong>DoÄŸum Tarihi:</strong> {{ results.input_dogum_gunu }}</p>
            <p><strong>Ä°sim Soyisim:</strong> {{ results.isim_soyisim }}</p>
            {% if results.eklenen_isim %}
            <p><strong>Ek Ä°sim:</strong> {{ results.eklenen_isim }}</p>
            {% endif %}
        </div>
        
        <h3>SonuÃ§lar:</h3>
        
        <div class="result-section">
            <h4>YaÅŸam Yolu:</h4>
            <p>{{ results.yasam_yolu }}</p>
        </div>

        <div class="result-section" style="background-color: #ffffff;">
            <div class="accordion-item">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    YaÅŸam Yolu AÃ§Ä±klamasÄ±
                    <span class="accordion-icon">â–¼</span>
                </button>
                <div class="accordion-content">
                    <pre>{{ results.yasam_yolu_aciklama | safe }}</pre>
                </div>
            </div>
        </div>

        <div class="result-section">
            <h4>Bereket SayÄ±sÄ±:</h4>
            <p>{{ results.bereket_sayisi }}</p>
        </div>

        <div class="result-section">
            <h4>Pin Kodu:</h4>
            <div class="pin-kodu-tablosu">
                <table>
                    <tr>
                        <td>{{ results.dogum_gunu.split(' ')[0] }}</td>
                        <td>{{ results.dogum_gunu.split(' ')[1] }}</td>
                        <td>{{ results.dogum_gunu.split(' ')[2] }}</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>{{ results.pin_kodu_dizilimi[0]}}</td>
                        <td>{{ results.pin_kodu_dizilimi[1] }}</td>
                        <td>{{ results.pin_kodu_dizilimi[2] }}</td>
                        <td>{{ results.pin_kodu_dizilimi[3] }}</td>
                        <td>{{ results.pin_kodu_dizilimi[4] }}</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>{{ results.pin_kodu_dizilimi[5] }}</td>
                        <td>{{ results.pin_kodu_dizilimi[6] }}</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>{{ results.pin_kodu_dizilimi[7]}}</td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>{{ results.pin_kodu_dizilimi[8] }}</td>
                        <td></td>
                        <td></td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="result-section" style="background-color: #ffffff;">
            <h4>Pin Kodu YorumlarÄ±:</h4>
            {% for yorum in results.pin_kodu_yorumlari %}
            <div class="accordion-item">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    {{ loop.index }}. Hane Yorumu
                    <span class="accordion-icon">â–¼</span>
                </button>
                <div class="accordion-content">
                    {{ yorum | safe }}
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="result-section">
            <h4>Ã‡akra DaÄŸÄ±lÄ±mÄ±:</h4>
            <div class="chakra-table">
                <table>
                    {% for chakra in results.chakra %}
                    <tr>
                        <td class="plus-cell">{{ chakra.left_plus }}</td>
                        <td class="number-cell">{{ chakra.number }}</td>
                        <td class="plus-cell">{{ chakra.right_plus }}</td>
                        {% if chakra.has_ek_isim %}
                        <td class="separator-cell">|</td>
                        <td class="ek-plus-cell">{{ chakra.ek_plus }}</td>
                        {% endif %}
                        <td class="pin-code-cell">{{ results.pin_kodu_dizilimi[9 - loop.index] }}</td>
                        <td class="chakra-letters-cell">{{ chakra.harfler }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </div>

        {% if results.chakra_yorumlari %}
        <div class="result-section" style="background-color: #ffffff;">
            <h4>Ã‡akra YorumlarÄ±:</h4>
            {% for yorum in results.chakra_yorumlari %}
            <div class="accordion-item">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    {{ loop.index }}. Ã‡akra Yorumu
                    <span class="accordion-icon">â–¼</span>
                </button>
                <div class="accordion-content">
                    <pre>{{ yorum | safe }}</pre>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="result-section">
            <h4>Merkez SayÄ± / Ana kulvar: (ek isim dahil deÄŸil)</h4>
            <p><strong>{{ results.merkez_sayi }}</strong></p>
            <div>
                <pre>{{ results.merkez_sayi_sonuc }}</pre>
            </div>
        </div>

        <div class="result-section">
            <h4>Tam Kulvar: (BÃ¼tÃ¼n harflerin toplamÄ±)</h4>
            <p>{{ results.tam_kulvar }}</p>
        </div>

        

        <div class="result-section">
            <h4>DÃ¶nÃ¼ÅŸÃ¼m YÄ±llarÄ±:</h4>
            <pre>{{ results.donusum_yillari }}</pre>

            <div class="accordion-item">
                <button class="accordion-button" onclick="toggleAccordion(this)">
                    DÃ¶nÃ¼ÅŸÃ¼m YÄ±llarÄ± Bilgi:
                    <span class="accordion-icon">â–¼</span>
                </button>
                <div class="accordion-content">
                    <pre>DÃ¶nÃ¼ÅŸÃ¼m yÄ±llarÄ±:
    Bir kiÅŸi uzun zamanlarda bir dÃ¶nÃ¼ÅŸÃ¼m yaÅŸÄ±yorsa ya da aynÄ± aralÄ±kta aynÄ± sayÄ± ile dÃ¶nÃ¼ÅŸÃ¼yorsa bu kiÅŸinin inatÃ§Ä± olduÄŸunu, zoor Ã¶ÄŸrendiÄŸini, kabul etmek istemediÄŸini gÃ¶sterebilir. aynÄ± zamanda o haneden Ã§ok Ã§etin zor bir imtihan yaÅŸÄ±yor ve orayÄ± atlatamÄ±yor olabilir. Tekrar tekrar Ã¼zerinden geÃ§iyor olabilir.

    EÄŸer kiÅŸi 3-5 yÄ±lda bir dÃ¶nÃ¼ÅŸÃ¼m yaÅŸÄ±yor ise bu kiÅŸi daha kolay bir Ã¶ÄŸrenme kabiliyetine sahiptir. DÃ¶nÃ¼ÅŸÃ¼m yÄ±llarÄ± o yÄ±lÄ±n iÃ§inde kendi doÄŸum tarihimizden sonra geÃ§erli olmaya baÅŸlar. 11/2* ya da 22/4* gibi sayÄ±lar Ã§Ä±ktÄ±ÄŸÄ± zaman extra zorluk demektir.

    1 ile dÃ¶nÃ¼ÅŸÃ¼m: Liderlik, eril enerji, kÃ¶k Ã§akra ve iskelet sistemi, kendini gÃ¶rme, doÄŸum ( 1 anneyi bedenen zorlamÄ±ÅŸ) , evlenme, boÅŸanma, manevi bir alana girme, mal-mÃ¼lk alma, toprak alma demektir. (parayÄ± kazanacak demektir.)

    2 ile dÃ¶nÃ¼ÅŸÃ¼m: DiÅŸil enerji, Ã¼retim, doÄŸurganlÄ±k , cinsellik ,sevgi sevgi enerjisi, aÅŸÄ±k olma potansiyeli platonik aÅŸk, kiÅŸi duygusal bir dÃ¶nemdedir, duygusal yaklaÅŸmak gerekir, ortaklÄ±k kurmak da demektir. sevgi arayÄ±ÅŸÄ±, DiÅŸi figÃ¼rlerden destek gÃ¶rme (anne-abla-arkadaÅŸ).

    3 ile dÃ¶nÃ¼ÅŸÃ¼m: 3 dÃ¶nÃ¼ÅŸÃ¼m yÄ±lÄ±nda kiÅŸi keyifli muhabbetlerden hoÅŸlanÄ±r. Medyatik iÅŸler, iletiÅŸim, sanal alem, sosyal medya, bakÄ±ÅŸ aÃ§Ä±sÄ±. Meslek sahibi olma, iletiÅŸim yÃ¶nÃ¼nde dilini ÅŸikayetten ve yakÄ±nmaktan korumalÄ±, kusur ve eleÅŸtiren kaÃ§Ä±nÄ±lmalÄ±. EÄŸer 3'Ã¼n pozitif yanÄ±nÄ± yaÅŸamak istiyorsa dilini insanlarÄ±n iyiliÄŸine kullanmalÄ±.

    4 ile dÃ¶nÃ¼ÅŸÃ¼m: Genel olarak 4 yÄ±llarÄ±mÄ±z da zorlanÄ±rÄ±z. Ruhumuzda yer alan bir hasar olursa ruhen dÃ¶nÃ¼ÅŸÃ¼m yaÅŸarÄ±z. ZorlandÄ±rÄ±ÄŸÄ±mÄ±z yÄ±llarda ya 4 etkisi vardÄ±r ya da aÃ§an hanede 4 etkisi vardÄ±r illa dÃ¶nÃ¼ÅŸÃ¼m yaÅŸamak zorunda deÄŸiliz. SabÄ±r, sebat, zorlanma, Ã¶ÄŸrenme, eÄŸitim. Bu dÃ¶nÃ¼ÅŸÃ¼m yÄ±lÄ±ndaysa kiÅŸi ciddi olarak konuÅŸmalÄ± ve uzatmadan Ã¶zet olarak sÃ¶ylemeli kiÅŸi sabÄ±rsÄ±zdÄ±r. yÄ±kÄ±m ve yeniden dÃ¼zen kurma yÄ±lÄ±dÄ±r, kiÅŸinin sorumluluklarÄ± artar yeniden bir dÃ¼zen kurar. Mesela, kiÅŸinin babasÄ±nÄ±n hastalÄ±klarÄ± artabilir, aÄŸÄ±r bir rahatsÄ±zlÄ±k geÃ§irebilir.

    5 ile dÃ¶nÃ¼ÅŸÃ¼m: ÅÃ¼kÃ¼r enerjisi, sevgi enerjisi, yÃ¼kseliÅŸ. Gezme tozma, keyif, eÄŸlence, bolca alÄ±ÅŸveriÅŸ yapma, para harcama, farklÄ± farklÄ± kÃ¼ltÃ¼rler tanÄ±ma. KiÅŸiye iÅŸ olarak yÃ¼kseliÅŸ ve baÅŸarÄ± da verebilir. (KiÅŸinin 5. Ã‡akrasÄ± nasÄ±l nasÄ±l Ã§alÄ±ÅŸÄ±yor ve pin kodunun 5. Hanesinde hangi rakam olduÄŸu Ã§ok Ã¶nemlidir.) AynÄ± zamanda bu yÃ¼kseliÅŸ mabinevi anlamda da olabilir. 5 dÃ¶nÃ¼ÅŸÃ¼m yÄ±llarÄ±nda kiÅŸinin kendini eve kapatÄ±p isyan etmeye meyilli vardÄ±r. O yÃ¼zden dikkat etmeli , ÅŸÃ¼kÃ¼r enerjisinden kalmalÄ±. DÃ¶nÃ¼ÅŸÃ¼m yÄ±llarÄ± ardÄ± ardÄ±na 5 Ã§Ä±kÄ±yorsa kiÅŸinin olaylara pozitif yanÄ±yla bakmasÄ±, ÅŸÃ¼kÃ¼r konusunda ekstra dikkat etmesi ve bu yaÅŸadÄ±ÄŸÄ±m olay beni ne kadar yÃ¼kseltti uyandÄ±rdÄ± diye sorgulamasÄ± iyi yanÄ±ndan bakmasÄ± gerekir. 5 sayÄ±sÄ±nÄ±n pozitif dÃ¶nÃ¼ÅŸÃ¼m / negatif dÃ¶nÃ¼ÅŸÃ¼m etkisi vardÄ±r bu ayrÄ±ma kiÅŸinin hangi sayÄ±larla ve pin kodunda 5. Haneye ardÄ±ndan 5. Ã‡akrasÄ±na bakarak yorum yapÄ±lÄ±r. 14/5 ile dÃ¶nÃ¼ÅŸÃ¼m yaÅŸÄ±yor ise 4 Ã¶ÄŸrenmek 1 bireysel 5 eÄŸlenerek Ã¶ÄŸrenmek diye yorumlayabiliriz.

    6 ile dÃ¶nÃ¼ÅŸÃ¼m: Sorumluluk alma, evlilik, Ã§ocuk. Ailesinden, babasÄ±ndan, hanÄ±mÄ±ndan, Ã§ocuÄŸundan, evlenme potansiyeline bahsedeceÄŸiz. (KiÅŸi genÃ§ ise doÄŸum hamilelik-doÄŸum olabilir) bir ÅŸey kurmak, bir ÅŸey baÅŸlatmak, aÅŸk ihtimali. DoÄŸum, kayÄ±p, Ã¶lÃ¼m, baba ile imtihan.

    7 ile dÃ¶nÃ¼ÅŸÃ¼m: Huzur ve arayÄ±ÅŸtÄ±r. Maneviyat olarak kendi iÃ§ine Ã§ekil, kendini tanÄ±, Ã¶zÃ¼n dÃ¶n, kalabalÄ±klar iÃ§inde kendini yalnÄ±z hissetme, bireysel baÅŸarÄ±ya Ã¶nem verilmeli. AynÄ± zamanda spiritÃ¼el alanlara yÃ¶nelme. 7 yÄ±lÄ±nda altÄ±na imza attÄ±ÄŸÄ±n her ÅŸeye dikkat et. Davet edildiÄŸi her yere katÄ±lmaya Ã¶zen gÃ¶ster, her davette bir fÄ±rsat yakalayabilirsin. YaptÄ±ÄŸÄ±n iyiliklerin karÅŸÄ±lÄ±ÄŸÄ±nÄ± o yÄ±l bekleme bir sonraki yÄ±l fazla fazla alÄ±rsÄ±n. Maddi olarak karÅŸÄ±lÄ±ÄŸÄ± az olan iÅŸlerde dahi yardÄ±m et ve bir sonraki yÄ±l karÅŸÄ±lÄ±ÄŸÄ±nÄ± bekle. KiÅŸi ne istiyor karar vermeli, yardÄ±m kuruluÅŸlarÄ±nda gÃ¶nÃ¼llÃ¼ yer alabilir. Kendi iÃ§ine Ã§ekilip maneviyatÄ±nÄ± gÃ¼Ã§lendirebilir. Para istiyor ise yatÄ±rÄ±m yapmalÄ± ama para akÄ±ÅŸÄ± bir sonraki yÄ±l artar. Pin kodunda 7. Hane 3 ile aÃ§Ä±lÄ±yorsa iletiÅŸim anlamÄ±nda, ortaklÄ± iÅŸ yapma, sÃ¶zleÅŸmeler, her davete katÄ±lma konusunda Ã§alÄ±ÅŸÄ±r.

    8 ile dÃ¶nÃ¼ÅŸÃ¼m: Ruh, gÃ¼Ã§, otorite, korunma, makam-mevkii, ÅŸÃ¶hret, bereket, para-pul, aynÄ± zamanda yer deÄŸiÅŸikliÄŸi de olabilir. Bir yÄ±l Ã¶ncesinden ne verdiysen katlayarak sana geri verir. EÄŸer bir Ã¶nceki yÄ±lÄ± yanlÄ±ÅŸ deÄŸerlendirdiysen 8 yÄ±lÄ± yÄ±kÄ±m olabilir, maddi zarar olabilir. Ä°yi deÄŸerlendirdiysen bol kazanÃ§ ve yÃ¼kseliÅŸ yaÅŸarsÄ±n. Bir iÅŸ yeri baÅŸka ÅŸubeler aÃ§abilir ya da yeni bir iÅŸ yeri aÃ§ma, yeni bir iÅŸte yÃ¼kselme Ã§ok karlÄ± projeler yaparak yÃ¼klÃ¼ kazanÃ§lar olabilir.

    9 ile dÃ¶nÃ¼ÅŸÃ¼m: KiÅŸiye ÅŸifalanacaÄŸÄ± alanlardan bahsedebiliriz, bitiÅŸler ve kayÄ±plar olabilir, bitiÅŸ demektir. SÄ±nÄ±rlarÄ± korumak ile alakalÄ±dÄ±r. 9 dÃ¶nÃ¼ÅŸÃ¼m yÄ±lÄ±nda yeni bir iÅŸe baÅŸlanacak eÄŸer kiÅŸinin pin kodunda 9. haneye bakarÄ±z eÄŸer 1 varsa o kiÅŸi iÃ§in olumludur benlik, bireysellik, liderlik konusunda ÅŸifalanma diyebiliriz. DÃ¼zenli olarak tahliller yaptÄ±rmasÄ±nÄ±, ihtiyacÄ±na gÃ¶re tedavilere yÃ¶nelerek ( hacamat, sÃ¼lÃ¼k, bilinÃ§altÄ± vb.) ÅŸifalanabilir gibi tavsiyeler verebiliriz.
    
    NOT: KiÅŸinin dÃ¶nÃ¼ÅŸÃ¼m yÄ±lÄ±ndaki rakamÄ±n pin koduna ve Ã§akra daÄŸÄ±lÄ±mdaki + lara bakarsak Ã§ok daha detaylÄ± bilgiye ulaÅŸabilirsiniz.
                    </pre>
                </div>
            </div>
        </div>

        <div class="result-section">
            <h4>MizaÃ§ Ã–zellikleri:</h4>
            <div class="mizac-tablosu">
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th >esnek</th>
                            <th >katÄ±</th>
                            <th >baskÄ±n</th>
                            <th >edilgen</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>hava</strong></td>
                            <td>{{ results.pin_kodu_ozellikleri.hava.esnek }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.hava.katÄ± }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.hava.baskÄ±n }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.hava.edilgen }}</td>
                        </tr>
                        <tr>
                            <td><strong>su</strong></td>
                            <td>{{ results.pin_kodu_ozellikleri.su.esnek }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.su.katÄ± }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.su.baskÄ±n }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.su.edilgen }}</td>
                        </tr>
                        <tr>
                            <td><strong>toprak</strong></td>
                            <td>{{ results.pin_kodu_ozellikleri.toprak.esnek }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.toprak.katÄ± }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.toprak.baskÄ±n }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.toprak.edilgen }}</td>
                        </tr>
                        <tr>
                            <td><strong>ateÅŸ</strong></td>
                            <td>{{ results.pin_kodu_ozellikleri.ates.esnek }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.ates.katÄ± }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.ates.baskÄ±n }}</td>
                            <td>{{ results.pin_kodu_ozellikleri.ates.edilgen }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script>
// Flash mesajlarÄ±nÄ± kontrol et ve pop-up gÃ¶ster
document.addEventListener('DOMContentLoaded', function() {
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% if category == 'error' %}
                    showErrorModal('{{ message }}');
                {% endif %}
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    const dateInput = document.getElementById('dogum_gunu');
    const datePicker = document.getElementById('date_picker');

    // Date picker'dan text input'a
    datePicker.addEventListener('change', function(e) {
        if (e.target.value) {
            const date = new Date(e.target.value);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            dateInput.value = `${day}.${month}.${year}`;
        }
    });

    // Text input'tan date picker'a
    dateInput.addEventListener('input', function(e) {
        const value = e.target.value;
        // TÃ¼m ayraÃ§larÄ± nokta ile deÄŸiÅŸtir
        const normalized = value.replace(/[/\s-]/g, '.');
        const parts = normalized.split('.');
        
        if (parts.length === 3) {
            const day = parts[0].padStart(2, '0');
            const month = parts[1].padStart(2, '0');
            const year = parts[2];
            
            // GeÃ§erli bir tarih mi kontrol et
            const date = new Date(year, month - 1, day);
            if (!isNaN(date) && date.getFullYear() == year) {
                datePicker.value = `${year}-${month}-${day}`;
            }
        }
    });
    
    // Modal kapatma
    const closeBtn = document.querySelector('.close-modal');
    if (closeBtn) {
        closeBtn.onclick = function() {
            closeErrorModal();
        }
    }
    
    window.onclick = function(event) {
        const modal = document.getElementById('errorModal');
        if (event.target == modal) {
            closeErrorModal();
        }
    }
});

function showErrorModal(message) {
    const modal = document.getElementById('errorModal');
    const errorMessage = document.getElementById('errorMessage');
    errorMessage.textContent = message;
    modal.style.display = 'block';
}

function closeErrorModal() {
    const modal = document.getElementById('errorModal');
    modal.style.display = 'none';
}

function toggleAccordion(button) {
    const item = button.parentElement;
    const isActive = item.classList.contains('active');
    
    // TÃ¼m aÃ§Ä±k accordion'larÄ± kapat
    document.querySelectorAll('.accordion-item').forEach(accordionItem => {
        accordionItem.classList.remove('active');
    });
    
    // EÄŸer tÄ±klanan kapalÄ±ysa, onu aÃ§
    if (!isActive) {
        item.classList.add('active');
    }
}
</script>

<style>
/* Error Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 30px;
    border: 2px solid #ff8c00;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    text-align: center;
}

.modal-content h3 {
    color: #d32f2f;
    margin-bottom: 15px;
    font-size: 1.5em;
}

.modal-content p {
    color: #333;
    font-size: 1.1em;
    margin: 20px 0;
    line-height: 1.6;
}

.close-modal {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    position: absolute;
    right: 15px;
    top: 10px;
}

.close-modal:hover,
.close-modal:focus {
    color: #000;
}

.modal-btn {
    background-color: #ff8c00;
    color: white;
    padding: 12px 30px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1em;
    margin-top: 15px;
    transition: background-color 0.3s;
}

.modal-btn:hover {
    background-color: #e67e00;
}

.pin-kodu-tablosu {
    margin: 10px 0;
}

.pin-kodu-tablosu table {
    border-collapse: separate;
    border-spacing: 10px;
    margin: 0;
}

.pin-kodu-tablosu td {
    padding: 5px 10px;
    text-align: center;
    font-size: 1.2em;
    min-width: 40px;
    border: none;
    background-color: transparent;
}

.pin-kodu-tablosu tr:first-child td {
    background-color: transparent;
    font-weight: normal;
}

.pin-kodu-yorum {
    background-color: #f8f9fa;
    padding: 15px;
    margin: 10px 0;
    border-radius: 5px;
    border-left: 4px solid #ff8c00;
    white-space: pre-line;
}

.pin-kodu-yorum:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.result-section {
    background-color: #f8f9fa;
    padding: 15px;
    margin: 15px 0;
    border-radius: 5px;
}

.chakra-table {
    margin: 10px 0;
    overflow-x: auto;
    max-width: 100%;
}

.chakra-table table {
    border-collapse: separate;
    border-spacing: 10px;
    margin: 0;
    min-width: 600px;
}

.chakra-table td {
    padding: 5px 10px;
    text-align: center;
    font-family: monospace;
    font-size: 1.2em;
}

.chakra-table .plus-cell {
    color: #080808;
    min-width: 100px;
}

.chakra-table .plus-cell:first-child {
    text-align: right;
}

.chakra-table .plus-cell:nth-child(3) {
    text-align: left;
    padding-left: 0;
}

.chakra-table .number-cell {
    font-weight: bold;
    color: #1e1e1e;
    min-width: 40px;
}

.chakra-table .pin-code-cell {
    text-align: left;
    padding-left: 30px;
    min-width: 60px;
    color: #080808;
    font-weight: bold;
}

.chakra-table .separator-cell {
    color: #080808;
    min-width: 20px;
    text-align: center;
    font-weight: bold;
}

.chakra-table .ek-plus-cell {
    color: #080808;
    min-width: 100px;
    text-align: left;
    padding-left: 0;
    white-space: nowrap;
}

.chakra-table .chakra-letters-cell {
    text-align: right;
    padding-right: 0;
    min-width: 150px;
    color: #080808;
    font-size: 0.95em;
    white-space: nowrap;
}

.accordion-item {
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.accordion-button {
    width: 100%;
    padding: 15px;
    background-color: #f8f9fa;
    border: none;
    text-align: left;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1em;
    color: #333;
    transition: background-color 0.3s;
}

.accordion-button:hover {
    background-color: #e9ecef;
}

.accordion-icon {
    font-size: 0.8em;
    transition: transform 0.3s;
}

.accordion-content {
    padding: 0 15px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
    background-color: white;
    font-family: Arial, sans-serif;
    font-size: 1rem;
    line-height: 1.6;
}

.accordion-item.active .accordion-content {
    padding: 15px;
    max-height: none; /* Ä°Ã§eriÄŸin tamamÄ±nÄ± gÃ¶ster */
    height: auto;
}

.accordion-item.active .accordion-icon {
    transform: rotate(180deg);
}

.accordion-content pre {
    font-family: Arial, sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    white-space: pre-wrap;
    background-color: transparent;
    padding: 0;
    margin: 0;
}

.result-section pre {
    font-family: Arial, sans-serif;
    font-size: 1rem;
    line-height: 1.6;
    white-space: pre-wrap;
    background-color: #f8f9fa;
    padding: 1.5rem;
    border-radius: 6px;
}

/* Responsive design for mobile */
@media (max-width: 768px) {
    .chakra-table {
        overflow-x: scroll;
        -webkit-overflow-scrolling: touch;
    }
    
    .chakra-table table {
        min-width: 500px;
        border-spacing: 5px;
    }
    
    .chakra-table td {
        padding: 3px 5px;
        font-size: 1em;
    }
    
    .chakra-table .plus-cell {
        min-width: 70px;
    }
    
    .chakra-table .ek-plus-cell {
        min-width: 70px;
    }
    
    .chakra-table .pin-code-cell {
        padding-left: 15px;
        min-width: 40px;
    }
    
    .result-section {
        padding: 10px;
    }
    
    .pin-kodu-tablosu {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    
    .pin-kodu-tablosu table {
        min-width: 300px;
        border-spacing: 5px;
    }
    
    .pin-kodu-tablosu td {
        padding: 3px 5px;
        font-size: 1em;
        min-width: 30px;
    }
}

.mizac-tablosu {
    margin: 10px 0;
    overflow-x: auto;
}

.mizac-tablosu table {
    border-collapse: separate;
    border-spacing: 6px;
    margin: 0;
    width: 100%;
    max-width: 650px;
}

.mizac-tablosu td {
    padding: 4px 7px;
    text-align: center;
    font-size: 1em;
    min-width: 30px;
    border: none;
    background-color: transparent;
}

    .mizac-tablosu th {
    padding: 3px 6px;
    text-align: center;
    font-size: 0.8em;
    font-weight: bold;
    min-width: 30px;
}

/* PDF Download Button */
.pdf-download-container {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 15px;
}

.pdf-download-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    background: linear-gradient(135deg, #ff8c00, #ff6b00);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
}

.pdf-download-btn:hover {
    background: linear-gradient(135deg, #ff6b00, #ff5500);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 140, 0, 0.4);
}

.pdf-download-btn:active {
    transform: translateY(0);
}

.pdf-download-btn svg {
    flex-shrink: 0;
}

/* PDF Loading State */
.pdf-download-btn.loading {
    opacity: 0.7;
    pointer-events: none;
}

.pdf-download-btn.loading::after {
    content: '...';
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60%, 100% { content: '...'; }
}
</style>

{% if results %}
<!-- jsPDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script>
// Turkish character conversion function
function convertTurkish(text) {
    if (!text) return '';
    var turkishMap = {
        'ÄŸ': 'g', 'Ä': 'G',
        'Ã¼': 'u', 'Ãœ': 'U',
        'ÅŸ': 's', 'Å': 'S',
        'Ä±': 'i', 'Ä°': 'I',
        'Ã¶': 'o', 'Ã–': 'O',
        'Ã§': 'c', 'Ã‡': 'C'
    };
    return text.replace(/[ÄŸÄÃ¼ÃœÅŸÅÄ±Ä°Ã¶Ã–Ã§Ã‡]/g, function(char) { return turkishMap[char] || char; });
}

// Clean HTML tags from text
function cleanHtmlTags(text) {
    if (!text) return '';
    // Replace <br>, <br/>, <br /> with newline
    text = text.replace(/<br\s*\/?>/gi, '\n');
    // Replace multiple newlines with double newline
    text = text.replace(/\n{3,}/g, '\n\n');
    // Remove other HTML tags
    text = text.replace(/<[^>]*>/g, '');
    // Clean up extra whitespace
    text = text.replace(/[ \t]+/g, ' ');
    return text.trim();
}

// Replace emojis with text symbols for PDF
function replaceEmojis(text) {
    if (!text) return '';
    var emojiMap = {
        'ğŸ”¹': '>>',
        'ğŸŒ¿': '[+]',
        'ğŸŒ‘': '[-]',
        'ğŸ§­': '[*]',
        'ğŸ’¡': '[!]',
        'ğŸ”‘': '[#]',
        'ğŸŒŸ': '[*]',
        'âœ…': '[v]',
        'âš ï¸': '[!]',
        'ğŸ“Œ': '[>]',
        'â€¢': '-',
        'â†’': '->',
        'â†': '<-',
        'â˜…': '*',
        'â˜†': '*',
        'â—': '-',
        'â—‹': '-',
        'â—†': '-',
        'â—‡': '-',
        'â–¶': '>',
        'â—€': '<',
        'â–²': '^',
        'â–¼': 'v',
        'â– ': '-',
        'â–¡': '-',
        'ğŸ¯': '[>]',
        'ğŸ“Š': '[=]',
        'ğŸ“ˆ': '[^]',
        'âŒ': '[x]',
        'â“': '[?]',
        'â—': '[!]',
        'âœ¨': '*',
        'ğŸ”¥': '*',
        'ğŸ’ª': '[+]',
        'ğŸ™': '[+]',
        'â¤ï¸': '<3',
        'ğŸ’–': '<3',
        'ğŸŒˆ': '~',
        'â˜€ï¸': '*',
        'ğŸŒ™': '*',
        'â­': '*',
        'ğŸ””': '[!]',
        'ğŸ“': '[>]',
        'ğŸ‰': '*',
        'ğŸ‘‰': '->',
        'ğŸ‘ˆ': '<-',
        'ğŸ‘†': '^',
        'ğŸ‘‡': 'v'
    };
    
    // Replace known emojis
    for (var emoji in emojiMap) {
        if (emojiMap.hasOwnProperty(emoji)) {
            text = text.split(emoji).join(emojiMap[emoji]);
        }
    }
    
    // Remove any remaining emojis (Unicode ranges for emojis)
    text = text.replace(/[\u{1F300}-\u{1F9FF}]/gu, '');
    text = text.replace(/[\u{2600}-\u{26FF}]/gu, '');
    text = text.replace(/[\u{2700}-\u{27BF}]/gu, '');
    text = text.replace(/[\u{FE00}-\u{FE0F}]/gu, '');
    text = text.replace(/[\u{1F000}-\u{1F02F}]/gu, '');
    
    return text;
}

// PDF Generation Function
function generatePDF() {
    var btn = document.querySelector('.pdf-download-btn');
    btn.classList.add('loading');
    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg> Olusturuluyor...';
    
    setTimeout(function() {
    try {
        var jsPDF = window.jspdf.jsPDF;
        var doc = new jsPDF('p', 'mm', 'a4');
        
        var pageWidth = doc.internal.pageSize.getWidth();
        var pageHeight = doc.internal.pageSize.getHeight();
        var margin = 20;
        var contentWidth = pageWidth - margin * 2;
        var yPos = 0;
        
        // Helper function for text wrapping with page break
        function addWrappedText(text, x, startY, maxWidth, lineHeight, fontStyle, fontSize, textColor) {
            fontStyle = fontStyle || 'normal';
            fontSize = fontSize || 10;
            textColor = textColor || [60, 60, 60];
            
            doc.setFont('helvetica', fontStyle);
            doc.setFontSize(fontSize);
            doc.setTextColor(textColor[0], textColor[1], textColor[2]);
            
            // Clean HTML tags, replace emojis, and convert Turkish characters
            var cleanedText = cleanHtmlTags(text);
            var noEmojiText = replaceEmojis(cleanedText);
            var convertedText = convertTurkish(noEmojiText);
            var lines = doc.splitTextToSize(convertedText, maxWidth);
            var currentY = startY;
            
            for (var i = 0; i < lines.length; i++) {
                if (currentY > pageHeight - 25) {
                    doc.addPage();
                    doc.setFillColor(255, 140, 0);
                    doc.rect(0, 0, pageWidth, 12, 'F');
                    currentY = 25;
                }
                doc.text(lines[i], x, currentY);
                currentY += lineHeight;
            }
            return currentY;
        }
        
        // Colors
        var primaryColor = [255, 140, 0];
        var darkColor = [26, 26, 26];
        var grayColor = [100, 100, 100];
        var lightGray = [248, 249, 250];
        
        // Data from page
        var isimSoyisim = "{{ results.isim_soyisim }}";
        var dogumTarihi = "{{ results.input_dogum_gunu }}";
        var eklenenIsim = "{{ results.eklenen_isim | default('', true) }}";
        var dogumGunuParts = "{{ results.dogum_gunu }}".split(' ');
        var pinKodu = [
            "{{ results.pin_kodu_dizilimi[0] }}",
            "{{ results.pin_kodu_dizilimi[1] }}",
            "{{ results.pin_kodu_dizilimi[2] }}",
            "{{ results.pin_kodu_dizilimi[3] }}",
            "{{ results.pin_kodu_dizilimi[4] }}",
            "{{ results.pin_kodu_dizilimi[5] }}",
            "{{ results.pin_kodu_dizilimi[6] }}",
            "{{ results.pin_kodu_dizilimi[7] }}",
            "{{ results.pin_kodu_dizilimi[8] }}"
        ];
        var yasam_yolu = "{{ results.yasam_yolu }}";
        var merkez_sayi = "{{ results.merkez_sayi }}";
        var bereket_sayisi = "{{ results.bereket_sayisi }}";
        var tam_kulvar = "{{ results.tam_kulvar }}";
            
            // ============ COVER PAGE ============
            // Background gradient effect (simulated with rectangles)
            doc.setFillColor(26, 26, 26);
            doc.rect(0, 0, pageWidth, pageHeight, 'F');
            
            // Decorative elements
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 8, 'F');
            doc.rect(0, pageHeight - 8, pageWidth, 8, 'F');
            
            // Side accent lines
            doc.setDrawColor(255, 140, 0);
            doc.setLineWidth(0.5);
            doc.line(margin, 30, margin, pageHeight - 30);
            doc.line(pageWidth - margin, 30, pageWidth - margin, pageHeight - 30);
            
            // Title
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(36);
            doc.setTextColor(255, 255, 255);
            doc.text('NUMEROLOJI', pageWidth / 2, 70, { align: 'center' });
            
            doc.setFontSize(28);
            doc.setTextColor(255, 140, 0);
            doc.text('ANALIZ RAPORU', pageWidth / 2, 85, { align: 'center' });
            
            // Decorative line under title
            doc.setDrawColor(255, 140, 0);
            doc.setLineWidth(1);
            doc.line(pageWidth / 2 - 40, 95, pageWidth / 2 + 40, 95);
            
            // Person info box
            doc.setFillColor(40, 40, 40);
            doc.roundedRect(margin + 10, 115, pageWidth - margin * 2 - 20, eklenenIsim ? 70 : 55, 5, 5, 'F');
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(14);
            doc.setTextColor(150, 150, 150);
            doc.text('KISI BILGILERI', pageWidth / 2, 130, { align: 'center' });
            
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(20);
            doc.setTextColor(255, 255, 255);
            doc.text(convertTurkish(isimSoyisim.toUpperCase()), pageWidth / 2, 148, { align: 'center' });
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(14);
            doc.setTextColor(255, 140, 0);
            doc.text('Dogum Tarihi: ' + dogumTarihi, pageWidth / 2, 165, { align: 'center' });
            
            if (eklenenIsim) {
                doc.setTextColor(200, 200, 200);
                doc.text('Ek Isim: ' + convertTurkish(eklenenIsim), pageWidth / 2, 180, { align: 'center' });
            }
            
            // Pin Kodu Chart on cover
            yPos = eklenenIsim ? 210 : 195;
            doc.setFontSize(12);
            doc.setTextColor(150, 150, 150);
            doc.text('PIN KODU HARITASI', pageWidth / 2, yPos, { align: 'center' });
            
            // Pin kodu table
            yPos += 10;
            var cellSize = 12;
            var startX = pageWidth / 2 - (cellSize * 2.5);
            
            doc.setFontSize(10);
            doc.setTextColor(255, 140, 0);
            // Row 1 - Birth date parts
            doc.text(dogumGunuParts[0] || '', startX + cellSize * 0.5, yPos + 8, { align: 'center' });
            doc.text(dogumGunuParts[1] || '', startX + cellSize * 1.5, yPos + 8, { align: 'center' });
            doc.text(dogumGunuParts[2] || '', startX + cellSize * 2.5, yPos + 8, { align: 'center' });
            
            yPos += cellSize;
            doc.setFontSize(11);
            doc.setTextColor(255, 255, 255);
            // Row 2 - Pin codes 0-4
            for (var i = 0; i < 5; i++) {
                doc.text(pinKodu[i] || '', startX + cellSize * (i + 0.5), yPos + 8, { align: 'center' });
            }
            
            yPos += cellSize;
            // Row 3 - Pin codes 5-6
            doc.text(pinKodu[5] || '', startX + cellSize * 1.5, yPos + 8, { align: 'center' });
            doc.text(pinKodu[6] || '', startX + cellSize * 2.5, yPos + 8, { align: 'center' });
            
            yPos += cellSize;
            // Row 4 - Pin code 7
            doc.text(pinKodu[7] || '', startX + cellSize * 2.5, yPos + 8, { align: 'center' });
            
            yPos += cellSize;
            // Row 5 - Pin code 8
            doc.setTextColor(255, 140, 0);
            doc.setFontSize(12);
            doc.text(pinKodu[8] || '', startX + cellSize * 2.5, yPos + 8, { align: 'center' });
            
            // Footer text
            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text('Numeroloji-Ebced Hesaplama', pageWidth / 2, pageHeight - 25, { align: 'center' });
            
            // ============ PAGE 2 - YASAM YOLU ============
            doc.addPage();
            yPos = margin;
            
            // Header bar
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 12, 'F');
            
            // Section Title
            yPos = 25;
            doc.setFillColor(26, 26, 26);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 14, 2, 2, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('YASAM YOLU', pageWidth / 2, yPos + 9, { align: 'center' });
            
            yPos += 22;
            
            // YaÅŸam Yolu Number
            doc.setFillColor(255, 140, 0);
            doc.circle(pageWidth / 2, yPos + 10, 15, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(20);
            doc.setTextColor(255, 255, 255);
            doc.text(yasam_yolu, pageWidth / 2, yPos + 15, { align: 'center' });
            
            yPos += 35;
            
            // YaÅŸam Yolu Yorumu
            var yasam_yolu_aciklama = `{{ results.yasam_yolu_aciklama | replace('\n', '\\n') | replace('\r', '') | replace("'", "\\'") | safe }}`;
            yPos = addWrappedText(yasam_yolu_aciklama, margin + 5, yPos, contentWidth - 10, 5, 'normal', 10, [60, 60, 60]);
            
            // ============ PAGE - PIN KODU ============
            doc.addPage();
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 12, 'F');
            
            yPos = 25;
            doc.setFillColor(26, 26, 26);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 14, 2, 2, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('PIN KODU VE YORUMLARI', pageWidth / 2, yPos + 9, { align: 'center' });
            
            yPos += 27;
            
            // Pin Kodu Table (larger)
            var chartStartX = pageWidth / 2 - 30;
            var chartCellSize = 18;
            
            doc.setFillColor(248, 249, 250);
            doc.roundedRect(chartStartX - 15, yPos - 5, 90, 95, 3, 3, 'F');
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            doc.setTextColor(255, 140, 0);
            // Row 1 - Birth date parts
            doc.text(dogumGunuParts[0] || '', chartStartX + chartCellSize * 0.5, yPos + 10, { align: 'center' });
            doc.text(dogumGunuParts[1] || '', chartStartX + chartCellSize * 1.5, yPos + 10, { align: 'center' });
            doc.text(dogumGunuParts[2] || '', chartStartX + chartCellSize * 2.5, yPos + 10, { align: 'center' });
            
            yPos += chartCellSize;
            doc.setFontSize(14);
            doc.setTextColor(26, 26, 26);
            // Row 2 - Pin codes 0-4
            for (var i = 0; i < 5; i++) {
                doc.text(pinKodu[i] || '', chartStartX + chartCellSize * (i + 0.5), yPos + 10, { align: 'center' });
            }
            
            yPos += chartCellSize;
            // Row 3 - Pin codes 5-6
            doc.text(pinKodu[5] || '', chartStartX + chartCellSize * 1.5, yPos + 10, { align: 'center' });
            doc.text(pinKodu[6] || '', chartStartX + chartCellSize * 2.5, yPos + 10, { align: 'center' });
            
            yPos += chartCellSize;
            // Row 4 - Pin code 7
            doc.text(pinKodu[7] || '', chartStartX + chartCellSize * 2.5, yPos + 10, { align: 'center' });
            
            yPos += chartCellSize;
            // Row 5 - Pin code 8
            doc.setTextColor(255, 140, 0);
            doc.setFontSize(16);
            doc.text(pinKodu[8] || '', chartStartX + chartCellSize * 2.5, yPos + 10, { align: 'center' });
            
            yPos += 30;
            
            // Pin Kodu YorumlarÄ±
            {% for yorum in results.pin_kodu_yorumlari %}
            if (yPos > pageHeight - 50) {
                doc.addPage();
                doc.setFillColor(255, 140, 0);
                doc.rect(0, 0, pageWidth, 12, 'F');
                yPos = 25;
            }
            
            doc.setFillColor(255, 140, 0);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 8, 1, 1, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.setTextColor(255, 255, 255);
            doc.text('{{ loop.index }}. Hane Yorumu', margin + 5, yPos + 5.5);
            yPos += 12;
            
            var pinYorum{{ loop.index }} = `{{ yorum | replace('\n', '\\n') | replace('\r', '') | replace("'", "\\'") | safe }}`;
            yPos = addWrappedText(pinYorum{{ loop.index }}, margin + 5, yPos, contentWidth - 10, 4.5, 'normal', 9, [60, 60, 60]);
            yPos += 8;
            {% endfor %}
            
            // ============ PAGE - CAKRALAR ============
            doc.addPage();
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 12, 'F');
            
            yPos = 25;
            doc.setFillColor(26, 26, 26);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 14, 2, 2, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('CAKRA DAGILIMI VE YORUMLARI', pageWidth / 2, yPos + 9, { align: 'center' });
            
            yPos += 27;
            
            // Ã‡akra tablosu
            var chakraData = [
                {% for chakra in results.chakra %}
                {
                    left_plus: "{{ chakra.left_plus }}",
                    number: "{{ chakra.number }}",
                    right_plus: "{{ chakra.right_plus }}",
                    {% if chakra.has_ek_isim %}
                    ek_plus: "{{ chakra.ek_plus }}",
                    {% endif %}
                    pin_code: pinKodu[{{ 9 - loop.index }}]
                },
                {% endfor %}
            ];
            
            doc.setFillColor(248, 249, 250);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, chakraData.length * 10 + 10, 3, 3, 'F');
            
            yPos += 8;
            chakraData.forEach((chakra, idx) => {
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(chakra.left_plus, pageWidth / 2 - 30, yPos, { align: 'right' });
                
                doc.setTextColor(26, 26, 26);
                doc.setFont('helvetica', 'bold');
                doc.text(chakra.number, pageWidth / 2, yPos, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(100, 100, 100);
                doc.text(chakra.right_plus, pageWidth / 2 + 30, yPos, { align: 'left' });
                
                if (chakra.ek_plus) {
                    doc.text('|  ' + chakra.ek_plus, pageWidth / 2 + 60, yPos, { align: 'left' });
                }
                
                doc.setTextColor(255, 140, 0);
                doc.setFont('helvetica', 'bold');
                doc.text(chakra.pin_code, pageWidth - margin - 20, yPos, { align: 'center' });
                
                yPos += 10;
            });
            
            yPos += 15;
            
            // Ã‡akra YorumlarÄ±
            {% if results.chakra_yorumlari %}
            {% for yorum in results.chakra_yorumlari %}
            if (yPos > pageHeight - 50) {
                doc.addPage();
                doc.setFillColor(255, 140, 0);
                doc.rect(0, 0, pageWidth, 12, 'F');
                yPos = 25;
            }
            
            doc.setFillColor(255, 140, 0);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 8, 1, 1, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.setTextColor(255, 255, 255);
            doc.text('{{ loop.index }}. Cakra Yorumu', margin + 5, yPos + 5.5);
            yPos += 12;
            
            var chakraYorum{{ loop.index }} = `{{ yorum | replace('\n', '\\n') | replace('\r', '') | replace("'", "\\'") | safe }}`;
            yPos = addWrappedText(chakraYorum{{ loop.index }}, margin + 5, yPos, contentWidth - 10, 4.5, 'normal', 9, [60, 60, 60]);
            yPos += 8;
            {% endfor %}
            {% endif %}
            
            // ============ PAGE - MERKEZ SAYI ============
            doc.addPage();
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 12, 'F');
            
            yPos = 25;
            doc.setFillColor(26, 26, 26);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 14, 2, 2, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('MERKEZ SAYI / ANA KULVAR', pageWidth / 2, yPos + 9, { align: 'center' });
            
            yPos += 27;
            
            // Merkez SayÄ± Number
            doc.setFillColor(255, 140, 0);
            doc.circle(pageWidth / 2, yPos + 10, 15, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(20);
            doc.setTextColor(255, 255, 255);
            doc.text(merkez_sayi, pageWidth / 2, yPos + 15, { align: 'center' });
            
            yPos += 35;
            
            // Merkez SayÄ± Yorumu
            var merkez_sayi_sonuc = `{{ results.merkez_sayi_sonuc | replace('\n', '\\n') | replace('\r', '') | replace("'", "\\'") | safe }}`;
            yPos = addWrappedText(merkez_sayi_sonuc, margin + 5, yPos, contentWidth - 10, 5, 'normal', 10, [60, 60, 60]);
            
            yPos += 15;
            
            // Tam Kulvar
            if (yPos > pageHeight - 60) {
                doc.addPage();
                doc.setFillColor(255, 140, 0);
                doc.rect(0, 0, pageWidth, 12, 'F');
                yPos = 25;
            }
            
            doc.setFillColor(248, 249, 250);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 25, 3, 3, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.setTextColor(26, 26, 26);
            doc.text('Tam Kulvar (Butun harflerin toplami):', margin + 10, yPos + 10);
            doc.setFontSize(16);
            doc.setTextColor(255, 140, 0);
            doc.text(tam_kulvar, margin + 10, yPos + 20);
            
            // ============ PAGE - DONUSUM YILLARI ============
            doc.addPage();
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 12, 'F');
            
            yPos = 25;
            doc.setFillColor(26, 26, 26);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 14, 2, 2, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('DONUSUM YILLARI', pageWidth / 2, yPos + 9, { align: 'center' });
            
            yPos += 27;
            
            var donusum_yillari = `{{ results.donusum_yillari | replace('\n', '\\n') | replace('\r', '') | replace("'", "\\'") | safe }}`;
            yPos = addWrappedText(donusum_yillari, margin + 5, yPos, contentWidth - 10, 5, 'normal', 10, [60, 60, 60]);
            
            // ============ PAGE - MIZAC TABLOSU ============
            doc.addPage();
            doc.setFillColor(255, 140, 0);
            doc.rect(0, 0, pageWidth, 12, 'F');
            
            yPos = 25;
            doc.setFillColor(26, 26, 26);
            doc.roundedRect(margin, yPos, pageWidth - margin * 2, 14, 2, 2, 'F');
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('MIZAC OZELLIKLERI', pageWidth / 2, yPos + 9, { align: 'center' });
            
            yPos += 30;
            
            // MizaÃ§ tablosu using autoTable
            doc.autoTable({
                startY: yPos,
                head: [['', 'Esnek', 'Kati', 'Baskin', 'Edilgen']],
                body: [
                    ['Hava', '{{ results.pin_kodu_ozellikleri.hava.esnek }}', '{{ results.pin_kodu_ozellikleri.hava.katÄ± }}', '{{ results.pin_kodu_ozellikleri.hava.baskÄ±n }}', '{{ results.pin_kodu_ozellikleri.hava.edilgen }}'],
                    ['Su', '{{ results.pin_kodu_ozellikleri.su.esnek }}', '{{ results.pin_kodu_ozellikleri.su.katÄ± }}', '{{ results.pin_kodu_ozellikleri.su.baskÄ±n }}', '{{ results.pin_kodu_ozellikleri.su.edilgen }}'],
                    ['Toprak', '{{ results.pin_kodu_ozellikleri.toprak.esnek }}', '{{ results.pin_kodu_ozellikleri.toprak.katÄ± }}', '{{ results.pin_kodu_ozellikleri.toprak.baskÄ±n }}', '{{ results.pin_kodu_ozellikleri.toprak.edilgen }}'],
                    ['Ates', '{{ results.pin_kodu_ozellikleri.ates.esnek }}', '{{ results.pin_kodu_ozellikleri.ates.katÄ± }}', '{{ results.pin_kodu_ozellikleri.ates.baskÄ±n }}', '{{ results.pin_kodu_ozellikleri.ates.edilgen }}']
                ],
                theme: 'grid',
                headStyles: {
                    fillColor: [26, 26, 26],
                    textColor: [255, 255, 255],
                    fontSize: 11,
                    fontStyle: 'bold',
                    halign: 'center'
                },
                bodyStyles: {
                    fontSize: 11,
                    halign: 'center',
                    textColor: [60, 60, 60]
                },
                columnStyles: {
                    0: { fillColor: [248, 249, 250], fontStyle: 'bold', halign: 'left' }
                },
                margin: { left: margin, right: margin },
                styles: {
                    cellPadding: 5
                }
            });
            
            // Footer on last page
            yPos = doc.autoTable.previous.finalY + 30;
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.setTextColor(150, 150, 150);
            doc.text('Bu rapor Numeroloji-Ebced Hesaplama sistemi tarafindan olusturulmustur.', pageWidth / 2, yPos, { align: 'center' });
            doc.text(new Date().toLocaleDateString('tr-TR'), pageWidth / 2, yPos + 6, { align: 'center' });
            
            // Save PDF
            var fileName = convertTurkish(isimSoyisim).replace(/\s+/g, '_') + '_Numeroloji_Analizi.pdf';
            doc.save(fileName);
            
        } catch (error) {
            console.error('PDF olusturma hatasi:', error);
            alert('PDF olusturulurken bir hata olustu. Lutfen tekrar deneyin. Hata: ' + error.message);
        }
        
        // Reset button
        btn.classList.remove('loading');
        btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg> PDF Indir';
    }, 100);
}
</script>
{% endif %}
{% endblock %}